<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gárgolas Community | MauroAKD</title>

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&family=Syncopate:wght@700&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
/* === TU CSS ORIGINAL (SIN CAMBIOS) === */
:root{
--bg-dark:#050505;--card-bg:rgba(255,255,255,.03);--card-border:rgba(255,255,255,.08);
--gold:#d4af37;--gold-bright:#f7d774;
--gold-gradient:linear-gradient(135deg,#bf953f,#fcf6ba,#b38728,#fbf5b7,#aa771c);
--text-main:#fff;--text-dim:#a0a0a0}
body{margin:0;background:#050505;color:#fff;font-family:'Plus Jakarta Sans',sans-serif}
.navbar{display:flex;justify-content:space-between;align-items:center;padding:20px 8%;border-bottom:1px solid var(--card-border)}
.logo{font-family:'Syncopate';font-size:1.2rem}
.logo span{background:var(--gold-gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.btn-kick{background:var(--gold-gradient);border:none;padding:12px 24px;font-weight:800;cursor:pointer;border-radius:4px}
.btn-logout{background:transparent;border:1px solid var(--card-border);color:var(--text-dim);padding:8px 15px;width:100%}
.hero{text-align:center;padding:80px 20px 40px}
.main-title{font-family:'Syncopate';font-size:clamp(2rem,8vw,5rem);
background:var(--gold-gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.container{max-width:1200px;margin:auto;display:grid;grid-template-columns:1fr 350px;gap:40px;padding:40px 5%}
@media(max-width:900px){.container{grid-template-columns:1fr}}
.section-box{background:var(--card-bg);border:1px solid var(--card-border);border-radius:24px;padding:30px}
.rank-row td{padding:15px}
.user-card{background:var(--gold-gradient);padding:1px;border-radius:20px}
.user-card-inner{background:#050505;border-radius:19px;padding:30px}
.points-val{font-size:2.5rem;font-weight:800}
.user-info-nav{display:flex;align-items:center;gap:10px}
.user-info-nav img{width:28px;height:28px;border-radius:50%}
</style>
</head>

<body>

<nav class="navbar">
<div class="logo">GARGOLAS <span>COMMUNITY</span></div>
<div id="nav-auth">
<button class="btn-kick" onclick="startKickLogin()">Conectar Kick</button>
</div>
</nav>

<header class="hero">
<h1 class="main-title">GARGOLAS</h1>
<p style="color:#aaa">Comunidad MauroAKD</p>
</header>

<div class="container">
<main>
<div class="section-box">
<h3>TOP WATCHTIME</h3>
<table width="100%">
<tbody id="ranking-body"></tbody>
</table>
</div>
</main>

<aside>
<div id="user-view" class="user-card" style="display:none">
<div class="user-card-inner">
<span>Tus puntos</span>
<div id="user-points" class="points-val">0</div>
<button class="btn-logout" onclick="logout()">Cerrar sesión</button>
</div>
</div>

<div id="guest-view" class="section-box">
<p>Vinculá tu cuenta para sumar puntos</p>
<button class="btn-kick" style="width:100%" onclick="startKickLogin()">Vincular Kick</button>
</div>
</aside>
</div>

<script>
// ===== FIREBASE =====
firebase.initializeApp({
apiKey:"AIzaSyDC3QHg-JU00vHEx2V6VHHW__O4Fzm5NEk",
authDomain:"gargolascommunity.firebaseapp.com",
projectId:"gargolascommunity"
});

const auth=firebase.auth();
const db=firebase.firestore();

// ===== LOGIN KICK (REDIRECT) =====
function startKickLogin(){
const provider=new firebase.auth.OAuthProvider("kick");
auth.signInWithRedirect(provider);
}

// ===== RECUPERAR REDIRECT (ERA LO QUE FALTABA) =====
auth.getRedirectResult()
.then(r=>{
if(r.user){
const ref=db.collection("gargolas").doc(r.user.uid);
ref.get().then(d=>{
if(!d.exists){
ref.set({
nombre:r.user.displayName||"Gárgola",
puntos:0,
creado:firebase.firestore.FieldValue.serverTimestamp()
});
}
});
}
})
.catch(e=>console.error(e));

// ===== SESIÓN =====
function logout(){auth.signOut();}

auth.onAuthStateChanged(user=>{
const guest=document.getElementById("guest-view");
const userView=document.getElementById("user-view");
const nav=document.getElementById("nav-auth");

if(user){
guest.style.display="none";
userView.style.display="block";
nav.innerHTML=`<div class="user-info-nav">
<img src="${user.photoURL||''}">
<span>${user.displayName||"Gárgola"}</span>
</div>`;

db.collection("gargolas").doc(user.uid).onSnapshot(s=>{
if(s.exists) document.getElementById("user-points").innerText=s.data().puntos;
});
}else{
guest.style.display="block";
userView.style.display="none";
nav.innerHTML=`<button class="btn-kick" onclick="startKickLogin()">Conectar Kick</button>`;
}
});

// ===== RANKING =====
db.collection("gargolas").orderBy("puntos","desc").limit(10)
.onSnapshot(s=>{
const body=document.getElementById("ranking-body");
body.innerHTML="";
s.forEach((d,i)=>{
const x=d.data();
body.innerHTML+=`
<tr class="rank-row">
<td>#${i+1}</td>
<td>${x.nombre||"Gárgola"}</td>
<td>${x.puntos||0}</td>
</tr>`;
});
});
</script>

</body>
</html>
