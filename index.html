<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gárgolas Community | MauroAKD</title>

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&family=Syncopate:wght@700&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
/* === TODO TU CSS ORIGINAL (SIN CAMBIOS) === */
:root {
    --bg-dark:#050505;
    --gold-main:#d4af37;
    --gold-gradient:linear-gradient(135deg,#bf953f,#fcf6ba,#b38728,#fbf5b7,#aa771c);
    --card-bg:rgba(255,255,255,0.02);
    --card-border:rgba(212,175,55,0.12);
}
body {
    margin:0;
    background-color:var(--bg-dark);
    background-image:radial-gradient(circle at 50% 30%,rgba(184,134,11,0.12) 0%,transparent 60%);
    background-attachment:fixed;
    color:#fff;
    font-family:'Plus Jakarta Sans',sans-serif;
}
.shimmer-title {
    font-family:'Syncopate';
    font-size:clamp(2.5rem,8vw,5rem);
    background:linear-gradient(to right,#bf953f 20%,#fcf6ba 40%,#fcf6ba 60%,#bf953f 80%);
    background-size:200% auto;
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    animation:shine 3s linear infinite;
}
@keyframes shine { to { background-position:200% center } }
.navbar {
    display:flex;
    justify-content:space-between;
    padding:20px 8%;
    border-bottom:1px solid var(--card-border);
}
.btn-kick {
    background:var(--gold-gradient);
    border:none;
    padding:12px 24px;
    font-weight:800;
    border-radius:6px;
    cursor:pointer;
}
.container {
    max-width:1200px;
    margin:auto;
    display:grid;
    grid-template-columns:1fr 350px;
    gap:40px;
    padding:40px 5%;
}
.section-box {
    background:var(--card-bg);
    border:1px solid var(--card-border);
    border-radius:24px;
    padding:30px;
}
.points-val {
    font-size:3.5rem;
    font-weight:800;
    background:var(--gold-gradient);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
}
</style>
</head>

<body>

<nav class="navbar">
    <div class="logo">GARGOLAS <span>COMMUNITY</span></div>
    <div id="nav-auth">
        <button class="btn-kick" onclick="loginKick()">Conectar Kick</button>
    </div>
</nav>

<header style="text-align:center;padding:80px 20px">
    <h1 class="shimmer-title">GARGOLAS</h1>
    <p style="color:#555;letter-spacing:5px">Comunidad MauroAKD</p>
</header>

<div class="container">
<main>
    <div class="section-box">
        <h3>TOP WATCHTIME</h3>
        <table><tbody id="ranking-body"></tbody></table>
    </div>
</main>

<aside>
    <div id="user-view" class="section-box" style="display:none">
        <small>MIS PUNTOS</small>
        <div id="user-points" class="points-val">0</div>
        <button onclick="auth.signOut()">Cerrar sesión</button>
    </div>

    <div id="guest-view" class="section-box">
        <p>Logueate para sumar puntos</p>
        <button class="btn-kick" onclick="loginKick()">Vincular Kick</button>
    </div>
</aside>
</div>

<script>
/* ========= FIREBASE ========= */
firebase.initializeApp({
  apiKey: "TU_API_KEY",
  authDomain: "gargolascommunity.firebaseapp.com",
  projectId: "gargolascommunity"
});

const auth = firebase.auth();
const db = firebase.firestore();

/* ========= LOGIN KICK ========= */
function loginKick() {
  window.location.href = "https://gargolas-backend.onrender.com/auth/kick";
}

/* ========= TOKEN DESDE BACKEND ========= */
const params = new URLSearchParams(window.location.search);
const token = params.get("token");

if (token) {
  auth.signInWithCustomToken(token)
    .then(() => window.history.replaceState({}, document.title, "/"));
}

/* ========= AUTH STATE ========= */
auth.onAuthStateChanged(user => {
  const gv = document.getElementById("guest-view");
  const uv = document.getElementById("user-view");

  if (!user) {
    gv.style.display = "block";
    uv.style.display = "none";
    return;
  }

  gv.style.display = "none";
  uv.style.display = "block";

  const ref = db.collection("gargolas").doc(user.uid);
  ref.set({ puntos: 0 }, { merge: true });

  ref.onSnapshot(s => {
    if (s.exists) {
      document.getElementById("user-points").innerText =
        s.data().puntos.toLocaleString();
    }
  });
});
</script>

</body>
</html>
