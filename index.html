<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GÃ¡rgolas Community | MauroAKD</title>

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&family=Syncopate:wght@700&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root {
    --bg-dark: #050505;
    --gold-main: #d4af37;
    --gold-gradient: linear-gradient(135deg, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
    --card-bg: rgba(255, 255, 255, 0.02);
    --card-border: rgba(212, 175, 55, 0.12);
}

body {
    margin: 0;
    background-color: var(--bg-dark);
    /* Aura dorada oscura de fondo */
    background-image: radial-gradient(circle at 50% 30%, rgba(184, 134, 11, 0.12) 0%, transparent 60%);
    background-attachment: fixed;
    color: #fff;
    font-family: 'Plus Jakarta Sans', sans-serif;
}

/* === EFECTO BRILLITOS EN EL TITULO (SHIMMER) === */
.shimmer-title {
    font-family: 'Syncopate';
    font-size: clamp(2.5rem, 8vw, 5rem);
    margin: 0;
    background: linear-gradient(to right, #bf953f 20%, #fcf6ba 40%, #fcf6ba 60%, #bf953f 80%);
    background-size: 200% auto;
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: shine 3s linear infinite;
    display: inline-block;
}

@keyframes shine {
    to { background-position: 200% center; }
}

/* === NAVBAR === */
.navbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 8%;
    border-bottom: 1px solid var(--card-border);
    backdrop-filter: blur(10px);
}

.logo { font-family: 'Syncopate'; font-size: 1.1rem; letter-spacing: 1px; }
.logo span { background: var(--gold-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

.btn-kick {
    background: var(--gold-gradient);
    border: none;
    padding: 12px 24px;
    font-weight: 800;
    border-radius: 6px;
    cursor: pointer;
    transition: 0.3s;
    text-transform: uppercase;
    font-size: 0.7rem;
}
.btn-kick:hover { transform: scale(1.05); filter: brightness(1.2); }

/* === LAYOUT === */
.container { max-width: 1200px; margin: auto; display: grid; grid-template-columns: 1fr 350px; gap: 40px; padding: 40px 5%; }

.section-box {
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 24px;
    padding: 30px;
    backdrop-filter: blur(10px);
}

/* === RANKING === */
.rank-table { width: 100%; border-collapse: collapse; }
.rank-row td { padding: 18px 10px; border-bottom: 1px solid rgba(255,255,255,0.03); }
.rank-pos { color: var(--gold-main); font-weight: 800; font-size: 1.1rem; width: 50px; }

/* === RECOMPENSAS === */
.rewards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 15px;
    margin-top: 20px;
}
.reward-item-new {
    position: relative;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid var(--card-border);
    border-radius: 16px;
    padding: 20px 10px;
    text-align: center;
    overflow: hidden;
    transition: 0.3s;
}
.reward-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    filter: blur(1px) grayscale(1);
    opacity: 0.3;
}
.reward-icon { font-size: 2rem; }
.reward-name { font-size: 0.65rem; font-weight: 800; color: var(--gold-main); }
.lock-overlay {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: rgba(0,0,0,0.4);
    font-size: 0.9rem;
    color: #fff;
}

/* === SIDEBAR === */
.user-card-inner { text-align: center; }
.points-val { 
    font-size: 3.5rem; 
    font-weight: 800; 
    background: var(--gold-gradient); 
    -webkit-background-clip: text; 
    -webkit-text-fill-color: transparent;
    margin: 10px 0;
}

@media(max-width:900px){ .container { grid-template-columns: 1fr; } }
</style>
</head>
<body>

<nav class="navbar">
    <div class="logo">GARGOLAS <span>COMMUNITY</span></div>
    <div id="nav-auth">
        <button class="btn-kick" onclick="startKickLogin()">Conectar Kick</button>
    </div>
</nav>

<header style="text-align: center; padding: 80px 20px 20px;">
    <h1 class="shimmer-title">GARGOLAS</h1>
    <p style="color:#555; letter-spacing: 5px; margin-top: 10px; font-weight: 300;">Comunidad MauroAKD</p>
</header>

<div class="container">
    <main>
        <div class="section-box">
            <h3 style="color:var(--gold-main); margin-top:0; letter-spacing: 2px;">TOP WATCHTIME</h3>
            <table class="rank-table">
                <tbody id="ranking-body"></tbody>
            </table>
        </div>

        <div class="section-box" style="margin-top: 30px;">
            <h3 style="color:var(--gold-main); margin-top:0; letter-spacing: 2px;">RECOMPENSAS</h3>
            <div class="rewards-grid">
                <div class="reward-item-new">
                    <div class="lock-overlay">ðŸ”’ <br> <small>1,000 pts</small></div>
                    <div class="reward-content">
                        <span class="reward-icon">ðŸ’Ž</span>
                        <span class="reward-name">RANGO VIP</span>
                    </div>
                </div>
                <div class="reward-item-new">
                    <div class="lock-overlay">ðŸ”’ <br> <small>5,000 pts</small></div>
                    <div class="reward-content">
                        <span class="reward-icon">ðŸŽ®</span>
                        <span class="reward-name">DUO MAURO</span>
                    </div>
                </div>
                <div class="reward-item-new">
                    <div class="lock-overlay">ðŸ”’ <br> <small>10k pts</small></div>
                    <div class="reward-content">
                        <span class="reward-icon">ðŸ”¥</span>
                        <span class="reward-name">UNBAN PASS</span>
                    </div>
                </div>
                <div class="reward-item-new">
                    <div class="lock-overlay">ðŸ”’ <br> <small>25k pts</small></div>
                    <div class="reward-content">
                        <span class="reward-icon">ðŸ‘•</span>
                        <span class="reward-name">MERCH OFICIAL</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <aside>
        <div id="user-view" class="section-box" style="display:none; border-color: var(--gold-main);">
            <div class="user-card-inner">
                <small style="color:var(--gold-main); font-weight: 800; letter-spacing: 1px;">MIS PUNTOS</small>
                <div id="user-points" class="points-val">0</div>
                <button onclick="auth.signOut()" style="background:none; border:none; color:#444; cursor:pointer; font-size:0.75rem; text-decoration: underline;">Cerrar SesiÃ³n</button>
            </div>
        </div>

        <div id="guest-view" class="section-box" style="text-align: center;">
            <p style="color:#888; font-size: 0.9rem;">Logueate para empezar a sumar puntos por ver el stream.</p>
            <button class="btn-kick" style="width:100%" onclick="startKickLogin()">Vincular Kick</button>
        </div>
    </aside>
</div>

<script>
// === FIREBASE CONFIG ===
firebase.initializeApp({
    apiKey: "AIzaSyDC3QHg-JU00vHEx2V6VHHW__O4Fzm5NEk",
    authDomain: "gargolascommunity.firebaseapp.com",
    projectId: "gargolascommunity"
});

const auth = firebase.auth();
const db = firebase.firestore();

function startKickLogin() {
    const provider = new firebase.auth.OAuthProvider("kick");
    auth.signInWithRedirect(provider);
}

auth.getRedirectResult().then(r => {
    if(r.user) {
        const ref = db.collection("gargolas").doc(r.user.uid);
        ref.get().then(d => {
            if(!d.exists) {
                ref.set({
                    nombre: r.user.displayName || "GÃ¡rgola",
                    puntos: 0,
                    kick_user: r.user.displayName // Clave para el bot
                });
            }
        });
    }
});

auth.onAuthStateChanged(user => {
    const gv = document.getElementById("guest-view");
    const uv = document.getElementById("user-view");
    const nav = document.getElementById("nav-auth");

    if(user) {
        gv.style.display = "none"; uv.style.display = "block";
        nav.innerHTML = `<div style="display:flex; align-items:center; gap:10px; font-weight:bold; color:var(--gold-main); font-size:0.9rem">
            <img src="${user.photoURL || ''}" style="width:28px; border-radius:50%; border:1px solid var(--gold-main)">
            ${user.displayName}
        </div>`;
        db.collection("gargolas").doc(user.uid).onSnapshot(s => {
            if(s.exists) document.getElementById("user-points").innerText = s.data().puntos.toLocaleString();
        });
    } else {
        gv.style.display = "block"; uv.style.display = "none";
        nav.innerHTML = `<button class="btn-kick" onclick="startKickLogin()">Conectar Kick</button>`;
    }
});

// RANKING REAL-TIME
db.collection("gargolas").orderBy("puntos", "desc").limit(10).onSnapshot(s => {
    const body = document.getElementById("ranking-body");
    body.innerHTML = "";
    s.forEach((d, i) => {
        const x = d.data();
        body.innerHTML += `
        <tr class="rank-row">
            <td class="rank-pos">${i === 0 ? 'ðŸ¥‡' : '#' + (i + 1)}</td>
            <td style="font-weight:600; font-size:0.95rem;">${x.nombre}</td>
            <td align="right" style="font-weight:800; color:var(--gold-main); font-size:1.1rem;">${(x.puntos || 0).toLocaleString()}</td>
        </tr>`;
    });
});
</script>
</body>
</html>
