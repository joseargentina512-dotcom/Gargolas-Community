<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√°rgolas Community | MauroAKD</title>

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&family=Syncopate:wght@700&display=swap" rel="stylesheet">

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --bg-dark: #050505;
            --gold-main: #d4af37;
            --gold-gradient: linear-gradient(135deg, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            --card-bg: rgba(255, 255, 255, 0.02);
            --card-border: rgba(212, 175, 55, 0.12);
            --text-gray: #a0a0a0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: var(--bg-dark);
            color: #fff;
            font-family: 'Plus Jakarta Sans', sans-serif;
            overflow-x: hidden;
        }

        .gargoyle-bg {
            position: fixed;
            inset: 0;
            z-index: -1;
            pointer-events: none;
            background: 
                radial-gradient(circle at 20% 30%, rgba(212,175,55,0.08), transparent 40%),
                radial-gradient(circle at 80% 60%, rgba(212,175,55,0.06), transparent 45%);
        }

        /* NAVEGACI√ìN */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 5%;
            border-bottom: 1px solid var(--card-border);
            backdrop-filter: blur(15px);
            background: rgba(5, 5, 5, 0.8);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo { font-family: 'Syncopate'; font-size: 1.1rem; }
        .logo span { background: var(--gold-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        .nav-tabs { display: flex; gap: 8px; }
        .tab-btn {
            background: none;
            border: 1px solid var(--card-border);
            color: var(--text-gray);
            padding: 8px 14px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: 0.3s;
            font-size: 0.85rem;
        }
        .tab-btn.active { background: var(--gold-gradient); color: #000; border-color: transparent; }

        /* CONTENIDO PRINCIPAL */
        .main-content { max-width: 1200px; margin: 2rem auto; padding: 0 20px; }
        .tab-panel { display: none; animation: fadeIn 0.4s ease-out; }
        .tab-panel.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .section-box {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 24px;
            padding: 25px;
            backdrop-filter: blur(10px);
            margin-bottom: 2rem;
        }

        /* SISTEMA DE RACHAS (STREAKS) */
        .streak-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            background: rgba(212, 175, 55, 0.05);
            padding: 20px;
            border-radius: 15px;
            border: 1px dashed var(--gold-main);
            margin: 20px 0;
        }
        .streak-number { font-size: 2.5rem; font-weight: 800; color: #ff4500; text-shadow: 0 0 10px rgba(255,69,0,0.3); }

        /* GRID DE TIENDA (CORREGIDO) */
        .shop-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .shop-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--card-border);
            border-radius: 16px;
            padding: 18px;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: 0.3s;
        }
        .shop-item:hover { transform: translateY(-3px); background: rgba(212, 175, 55, 0.05); border-color: var(--gold-main); }
        .shop-item h4 { font-size: 0.9rem; margin: 10px 0; letter-spacing: 0.5px; text-transform: uppercase; }

        .points-val {
            font-size: 2.5rem;
            font-weight: 800;
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 5px 0;
        }

        .btn-kick {
            background: var(--gold-gradient);
            border: none;
            padding: 10px 20px;
            font-weight: 800;
            border-radius: 8px;
            cursor: pointer;
            color: #000;
            transition: 0.3s;
            width: 100%;
        }
        .btn-kick:disabled { opacity: 0.5; filter: grayscale(1); }

        .success-message { color: #10b981; background: rgba(16,185,129,0.1); padding: 10px; border-radius: 8px; margin: 10px 0; text-align: center; }

        @media (max-width: 768px) {
            .navbar { flex-direction: column; gap: 15px; }
            .nav-tabs { overflow-x: auto; width: 100%; justify-content: center; }
        }
    </style>
</head>

<body>
<div class="gargoyle-bg"></div>

<nav class="navbar">
    <div class="logo">GARGOLAS <span>COMMUNITY</span></div>
    <div class="nav-tabs">
        <button class="tab-btn active" onclick="switchTab('home')">üè† Home</button>
        <button class="tab-btn" onclick="switchTab('shop')">üõí Shop</button>
        <button class="tab-btn" onclick="switchTab('leaderboard')">üèÜ Ranking</button>
    </div>
    <button class="btn-kick" id="mainAuthBtn" style="width: auto;" onclick="loginKick()">Conectar Kick</button>
</nav>

<div class="main-content">
    <div id="msgContainer"></div>

    <section id="home" class="tab-panel active">
        <div class="section-box" style="text-align: center;">
            <div id="userView" style="display:none;">
                <h3>¬°Bienvenido, <span id="userName">G√°rgola</span>!</h3>
                <div class="points-val" id="userPoints">0</div>
                <p style="color:var(--text-gray)">PUNTOS ACTUALES</p>

                <div class="streak-container">
                    <div>
                        <div class="streak-number" id="streakVal">0</div>
                        <p>D√çAS DE RACHA üî•</p>
                    </div>
                    <button class="btn-kick" id="streakBtn" style="width: auto;" onclick="claimDaily()">¬°PRESENTE!</button>
                </div>
                <p id="streakInfo" style="font-size: 0.8rem; color: #888;">Marca presente cada 24hs para no perder tu racha.</p>
            </div>

            <div id="guestView">
                <p>Inicia sesi√≥n para ver tu racha y puntos.</p>
                <br>
                <button class="btn-kick" style="width: auto;" onclick="loginKick()">VINCULAR KICK</button>
            </div>
        </div>
    </section>

    <section id="shop" class="tab-panel">
        <div class="section-box">
            <h3 style="color:var(--gold-main); text-align: center;">üõí TIENDA DE RECOMPENSAS</h3>
            <div class="shop-grid" id="shopGrid">
                </div>
        </div>
    </section>

    <section id="leaderboard" class="tab-panel">
        <div class="section-box">
            <h3 style="color:var(--gold-main)">üèÜ TOP G√ÅRGOLAS</h3>
            <div id="leaderboardContent" style="margin-top: 20px; color: var(--text-gray);">Cargando ranking...</div>
        </div>
    </section>
</div>

<script>
// CONFIGURACI√ìN FIREBASE
const firebaseConfig = {
    apiKey: "TU_API_KEY",
    authDomain: "gargolascommunity.firebaseapp.com",
    projectId: "gargolascommunity"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const BACKEND_URL = "https://gargolas-backend.onrender.com";

// LISTA DE RECOMPENSAS SEG√öN IMAGEN
const rewards = [
    { name: "Hamburguesa 15k Max", price: 15000, icon: "üçî" },
    { name: "Tipeo 10k", price: 10000, icon: "‚å®Ô∏è" },
    { name: "Tipeo 5k", price: 5000, icon: "‚å®Ô∏è" },
    { name: "Juego de Steam (Max 10)", price: 20000, icon: "üéÆ" },
    { name: "Sub Kick", price: 8000, icon: "üíé" },
    { name: "Tipeo de 50k", price: 50000, icon: "‚å®Ô∏è" },
    { name: "Caja de CS", price: 12000, icon: "üì¶" },
    { name: "Premier CS", price: 25000, icon: "üî´" },
    { name: "Discord Nitro", price: 10000, icon: "üëæ" },
    { name: "Moderador", price: 100000, icon: "üõ†Ô∏è" },
    { name: "FC 26", price: 70000, icon: "‚öΩ" },
    { name: "Baile TikTok", price: 4000, icon: "üíÉ" },
    { name: "Historia IG (Lo que quieras)", price: 6000, icon: "üì∏" },
    { name: "Perif√©rico PC 40k", price: 40000, icon: "üñ±Ô∏è" },
    { name: "7TV Premium", price: 5000, icon: "üì∫" },
    { name: "Spotify Premium", price: 5000, icon: "üéß" },
    { name: "Zapatilla 47 Street", price: 60000, icon: "üëü" },
    { name: "Botines 100k Max", price: 100000, icon: "üëü" }
];

// RENDERIZAR TIENDA
function renderShop() {
    const grid = document.getElementById('shopGrid');
    grid.innerHTML = rewards.map(item => `
        <div class="shop-item">
            <span>${item.icon}</span>
            <h4>${item.name}</h4>
            <div class="points-val" style="font-size: 1.2rem;">${item.price.toLocaleString()}</div>
            <button class="btn-kick" onclick="buyItem('${item.name}', ${item.price})">CANJEAR</button>
        </div>
    `).join('');
}

// LOGICA DE RACHAS (CLAIM DAILY)
async function claimDaily() {
    const btn = document.getElementById('streakBtn');
    btn.disabled = true;
    try {
        const username = auth.currentUser.displayName;
        const res = await fetch(`${BACKEND_URL}/api/presente`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username })
        });
        const data = await res.json();
        
        if(data.success) {
            notify(`¬°Racha aumentada! Tienes ${data.streak} d√≠as üî•`);
            document.getElementById('streakVal').textContent = data.streak;
        } else {
            notify(data.error, 'error');
        }
    } catch(e) { notify("Error de servidor", "error"); }
    btn.disabled = false;
}

// FUNCIONES DE SOPORTE
function switchTab(tabId) {
    document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(tabId).classList.add('active');
    event.currentTarget.classList.add('active');
}

function notify(msg, type = 'success') {
    const container = document.getElementById('msgContainer');
    container.innerHTML = `<div class="${type}-message">${msg}</div>`;
    setTimeout(() => container.innerHTML = '', 4000);
}

function loginKick() { window.location.href = `${BACKEND_URL}/auth/kick`; }

auth.onAuthStateChanged(user => {
    if (user) {
        document.getElementById('userView').style.display = 'block';
        document.getElementById('guestView').style.display = 'none';
        const username = user.displayName || user.uid.split('_')[1];
        document.getElementById('userName').textContent = username;
        
        db.collection('users').doc(username).onSnapshot(doc => {
            if(doc.exists) {
                document.getElementById('userPoints').textContent = (doc.data().points || 0).toLocaleString();
                document.getElementById('streakVal').textContent = doc.data().streak || 0;
            }
        });
    }
});

document.addEventListener('DOMContentLoaded', () => {
    renderShop();
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('token')) {
        auth.signInWithCustomToken(urlParams.get('token')).then(() => {
            window.history.replaceState({}, '', '/');
        });
    }
});
</script>
</body>
</html>
